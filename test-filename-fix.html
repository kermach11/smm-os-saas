<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è fileName –¥–ª—è –∞—É–¥—ñ–æ</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéµ –¢–µ—Å—Ç –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è fileName –¥–ª—è –∞—É–¥—ñ–æ</h1>
        
        <div class="test-section info">
            <h3>–û–ø–∏—Å —Ç–µ—Å—Ç—É</h3>
            <p>–¶–µ–π —Ç–µ—Å—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î, —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è —ñ–º'—è —Ñ–∞–π–ª—É (fileName) –¥–ª—è –∞—É–¥—ñ–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å.</p>
            <p><strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –ü—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂—É–≤–∞–≤—Å—è –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∏–π –∞—É–¥—ñ–æ —Ñ–∞–π–ª, –±–æ —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–Ω–∞–ª–∞, —è–∫–∏–π —Å–∞–º–µ —Ñ–∞–π–ª –ø–æ—Ç—Ä—ñ–±–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∑ IndexedDB.</p>
            <p><strong>–†—ñ—à–µ–Ω–Ω—è:</strong> –î–æ–¥–∞–Ω–æ –ø–æ–ª–µ fileName –¥–æ –≤—Å—ñ—Ö –∞—É–¥—ñ–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω—å –¥–ª—è —Ç–æ—á–Ω–æ—ó —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó —Ñ–∞–π–ª—ñ–≤.</p>
        </div>

        <div class="test-section">
            <h3>–¢–µ—Å—Ç 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è fileName</h3>
            <button onclick="testFileNameSaving()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è fileName</button>
            <div id="test1-result"></div>
        </div>

        <div class="test-section">
            <h3>–¢–µ—Å—Ç 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞ fileName</h3>
            <button onclick="testFileNameLoading()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞ fileName</button>
            <div id="test2-result"></div>
        </div>

        <div class="test-section">
            <h3>–¢–µ—Å—Ç 3: –°–∏–º—É–ª—è—Ü—ñ—è –ø–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É</h3>
            <button onclick="testFullCycle()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –ø–æ–≤–Ω–∏–π —Ü–∏–∫–ª</button>
            <div id="test3-result"></div>
        </div>

        <div class="test-section">
            <h3>–õ–æ–≥–∏</h3>
            <div id="logs" class="log"></div>
            <button onclick="clearLogs()">–û—á–∏—Å—Ç–∏—Ç–∏ –ª–æ–≥–∏</button>
        </div>
    </div>

    <script>
        function log(message) {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.textContent += `[${timestamp}] ${message}\n`;
            logs.scrollTop = logs.scrollHeight;
            console.log(message);
        }

        function clearLogs() {
            document.getElementById('logs').textContent = '';
        }

        function testFileNameSaving() {
            log('üß™ –¢–µ—Å—Ç 1: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è fileName');
            
            try {
                // –°–∏–º—É–ª—é—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑ fileName
                const testSettings = {
                    audioSettings: {
                        backgroundMusic: {
                            enabled: true,
                            url: 'data:audio/mpeg;base64,test-data-here',
                            volume: 0.5,
                            loop: true,
                            autoPlay: true,
                            fileName: 'jungle-ambience-339096'
                        },
                        hoverSounds: {
                            enabled: true,
                            url: 'data:audio/wav;base64,hover-sound-data',
                            volume: 0.3,
                            fileName: 'hover-sound-effect'
                        }
                    }
                };

                // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ localStorage
                localStorage.setItem('mainPageSettings', JSON.stringify(testSettings));
                log('‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑ fileName –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ localStorage');

                // –ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ —á–∏ –∑–±–µ—Ä–µ–≥–ª–æ—Å—è
                const saved = JSON.parse(localStorage.getItem('mainPageSettings'));
                if (saved.audioSettings.backgroundMusic.fileName === 'jungle-ambience-339096') {
                    log('‚úÖ fileName –¥–ª—è backgroundMusic –∑–±–µ—Ä–µ–∂–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ');
                    document.getElementById('test1-result').innerHTML = '<div class="success">‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!</div>';
                } else {
                    log('‚ùå fileName –¥–ª—è backgroundMusic –Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–æ');
                    document.getElementById('test1-result').innerHTML = '<div class="error">‚ùå –¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–æ</div>';
                }

            } catch (error) {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ —Ç–µ—Å—Ç—ñ 1: ' + error.message);
                document.getElementById('test1-result').innerHTML = '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        function testFileNameLoading() {
            log('üß™ –¢–µ—Å—Ç 2: –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑–∞ fileName');
            
            try {
                // –°–∏–º—É–ª—é—î–º–æ —Ñ–∞–π–ª–∏ –≤ IndexedDB
                const mockIndexedDBFiles = [
                    {
                        name: 'jungle-ambience-339096',
                        type: 'audio',
                        url: 'data:audio/mpeg;base64,correct-jungle-file-data'
                    },
                    {
                        name: 'deep-strange-whoosh-183845',
                        type: 'audio', 
                        url: 'data:audio/mpeg;base64,wrong-whoosh-file-data'
                    }
                ];

                // –°–∏–º—É–ª—é—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑ fileName
                const audioSettings = {
                    backgroundMusic: {
                        enabled: true,
                        url: '',
                        fileName: 'jungle-ambience-339096'
                    }
                };

                // –°–∏–º—É–ª—é—î–º–æ –ª–æ–≥—ñ–∫—É –ø–æ—à—É–∫—É —Ñ–∞–π–ª—É –∑–∞ fileName
                const targetFileName = audioSettings.backgroundMusic.fileName;
                const foundFile = mockIndexedDBFiles.find(file => 
                    file.name === targetFileName && file.type === 'audio' && file.url
                );

                if (foundFile && foundFile.name === 'jungle-ambience-339096') {
                    log(`‚úÖ –ó–Ω–∞–π–¥–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–∞–π–ª –∑–∞ fileName: ${foundFile.name}`);
                    log(`‚úÖ URL —Ñ–∞–π–ª—É: ${foundFile.url.substring(0, 50)}...`);
                    document.getElementById('test2-result').innerHTML = '<div class="success">‚úÖ –¢–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ!</div>';
                } else {
                    log('‚ùå –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–∞–π–ª –∑–∞ fileName');
                    document.getElementById('test2-result').innerHTML = '<div class="error">‚ùå –¢–µ—Å—Ç –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–æ</div>';
                }

            } catch (error) {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ —Ç–µ—Å—Ç—ñ 2: ' + error.message);
                document.getElementById('test2-result').innerHTML = '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        function testFullCycle() {
            log('üß™ –¢–µ—Å—Ç 3: –°–∏–º—É–ª—è—Ü—ñ—è –ø–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É');
            
            try {
                log('1Ô∏è‚É£ –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–∏–±–∏—Ä–∞—î —Ñ–∞–π–ª –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ...');
                
                // –°–∏–º—É–ª—é—î–º–æ –≤–∏–±—ñ—Ä —Ñ–∞–π–ª—É –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ
                const selectedFile = {
                    name: 'my-background-music',
                    url: 'data:audio/mpeg;base64,very-long-audio-data-here'
                };

                // –°–∏–º—É–ª—é—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ñ (–∑ fileName)
                const constructorSettings = {
                    audioSettings: {
                        backgroundMusic: {
                            enabled: true,
                            url: selectedFile.url,
                            volume: 0.5,
                            loop: true,
                            autoPlay: true,
                            fileName: selectedFile.name
                        }
                    }
                };

                log(`‚úÖ –§–∞–π–ª –≤–∏–±—Ä–∞–Ω–æ: ${selectedFile.name}`);
                log(`‚úÖ fileName –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è—Ö: ${constructorSettings.audioSettings.backgroundMusic.fileName}`);

                log('2Ô∏è‚É£ –°–∏–º—É–ª—é—î–º–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–µ–∫—Ç—É (–≤–∏–¥–∞–ª–µ–Ω–Ω—è URL –≤–∞–∂–∫–∏—Ö —Ñ–∞–π–ª—ñ–≤)...');
                
                // –°–∏–º—É–ª—é—î–º–æ processAudioUrl —Ñ—É–Ω–∫—Ü—ñ—é
                const processedSettings = JSON.parse(JSON.stringify(constructorSettings));
                if (selectedFile.url.length > 1000) { // –°–∏–º—É–ª—é—î–º–æ –≤–∞–∂–∫–∏–π —Ñ–∞–π–ª
                    processedSettings.audioSettings.backgroundMusic.url = ''; // –í–∏–¥–∞–ª—è—î–º–æ URL
                    log('üîÑ URL –≤–∞–∂–∫–æ–≥–æ —Ñ–∞–π–ª—É –≤–∏–¥–∞–ª–µ–Ω–æ –ø—Ä–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—ñ');
                } else {
                    log('‚úÖ URL –ª–µ–≥–∫–æ–≥–æ —Ñ–∞–π–ª—É –∑–∞–ª–∏—à–µ–Ω–æ');
                }

                // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ localStorage
                localStorage.setItem('mainPageSettings', JSON.stringify(processedSettings));
                log('üíæ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ localStorage');

                log('3Ô∏è‚É£ –°–∏–º—É–ª—é—î–º–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Ç–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...');
                
                // –°–∏–º—É–ª—é—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ localStorage
                const loadedSettings = JSON.parse(localStorage.getItem('mainPageSettings'));
                log(`üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ –∑ localStorage: fileName = ${loadedSettings.audioSettings.backgroundMusic.fileName}`);
                log(`üìÇ URL –≤ localStorage: ${loadedSettings.audioSettings.backgroundMusic.url || '–ø–æ—Ä–æ–∂–Ω—ñ–π'}`);

                log('4Ô∏è‚É£ –°–∏–º—É–ª—é—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ IndexedDB –∑–∞ fileName...');
                
                // –°–∏–º—É–ª—é—î–º–æ IndexedDB —Ñ–∞–π–ª–∏
                const indexedDBFiles = [
                    {
                        name: 'my-background-music',
                        type: 'audio',
                        url: 'data:audio/mpeg;base64,restored-audio-data-from-indexeddb'
                    },
                    {
                        name: 'other-audio-file',
                        type: 'audio',
                        url: 'data:audio/mpeg;base64,wrong-file-data'
                    }
                ];

                // –°–∏–º—É–ª—é—î–º–æ –ø–æ—à—É–∫ –∑–∞ fileName
                const targetFileName = loadedSettings.audioSettings.backgroundMusic.fileName;
                const restoredFile = indexedDBFiles.find(file => 
                    file.name === targetFileName && file.type === 'audio' && file.url
                );

                if (restoredFile) {
                    log(`‚úÖ –§–∞–π–ª –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ –∑ IndexedDB: ${restoredFile.name}`);
                    log(`‚úÖ URL –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–æ: ${restoredFile.url.substring(0, 50)}...`);
                    
                    // –û–Ω–æ–≤–ª—é—î–º–æ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
                    loadedSettings.audioSettings.backgroundMusic.url = restoredFile.url;
                    log('‚úÖ –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –æ–Ω–æ–≤–ª–µ–Ω–æ –∑ –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–∏–º URL');
                    
                    document.getElementById('test3-result').innerHTML = '<div class="success">‚úÖ –ü–æ–≤–Ω–∏–π —Ü–∏–∫–ª –ø—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ! –ü—Ä–∞–≤–∏–ª—å–Ω–∏–π —Ñ–∞–π–ª –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ.</div>';
                } else {
                    log('‚ùå –§–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ IndexedDB –∑–∞ fileName');
                    document.getElementById('test3-result').innerHTML = '<div class="error">‚ùå –§–∞–π–ª –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∑–∞ fileName</div>';
                }

            } catch (error) {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤ —Ç–µ—Å—Ç—ñ 3: ' + error.message);
                document.getElementById('test3-result').innerHTML = '<div class="error">‚ùå –ü–æ–º–∏–ª–∫–∞: ' + error.message + '</div>';
            }
        }

        // –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø—É—Å–∫–∞—î–º–æ —Ç–µ—Å—Ç–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
        window.onload = function() {
            log('üöÄ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è fileName –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è —Ä–æ–∑–ø–æ—á–∞—Ç–æ');
            log('‚ÑπÔ∏è –ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è –∑–∞–ø—É—Å–∫—É —Ç–µ—Å—Ç—ñ–≤');
        };
    </script>
</body>
</html> 