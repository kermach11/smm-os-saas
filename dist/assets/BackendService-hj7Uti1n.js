var c=Object.defineProperty;var a=(r,e,t)=>e in r?c(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var n=(r,e,t)=>a(r,typeof e!="symbol"?e+"":e,t);class l{constructor(){n(this,"siteId");n(this,"baseUrl");n(this,"isLocalDev");this.siteId=this.generateSiteId(),this.baseUrl="/.netlify/functions",this.isLocalDev=this.checkIfLocalDev()}checkIfLocalDev(){const e=window.location.hostname,t=window.location.port;return e==="localhost"||e==="127.0.0.1"||e.includes("192.168")||t==="5173"||t==="3000"}generateSiteId(){const e=window.location.hostname;return e==="localhost"||e==="127.0.0.1"||e.includes("192.168")?e.replace(/\./g,"-"):e.replace(/\./g,"-")}isAdminAuthenticated(){try{if(!this.isLocalDev)return!0;const e=localStorage.getItem("adminSession");if(!e)return!1;const t=JSON.parse(e),s=new Date().getTime();return t.expiry>s}catch{return!1}}async saveSettings(e,t){try{if(this.isLocalDev)return!0;if(!this.isAdminAuthenticated())return console.warn(`üîí BackendService: –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π –¥–æ—Å—Ç—É–ø –¥–æ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è ${e}`),!1;const s=await fetch(`${this.baseUrl}/save-settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:this.siteId,settingsType:e,data:t})});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);return(await s.json()).success}catch(s){return console.error(`‚ùå BackendService: –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è ${e}:`,s),!1}}async loadSettings(e){try{if(this.isLocalDev)return null;const t=await fetch(`${this.baseUrl}/load-settings?siteId=${this.siteId}&settingsType=${e}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();return s.success&&s.data?s.data:(console.log(`‚ÑπÔ∏è BackendService: ${e} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ`),null)}catch(t){return console.error(`‚ùå BackendService: –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ${e}:`,t),null}}async checkConnection(){try{return this.isLocalDev?!1:(await fetch(`${this.baseUrl}/load-settings?siteId=test&settingsType=test`)).status!==404}catch{return console.warn("‚ö†Ô∏è BackendService: Backend –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ª–æ–∫–∞–ª—å–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è"),!1}}getSiteInfo(){return{siteId:this.siteId,domain:window.location.hostname,isLocalDev:this.isLocalDev}}async syncWithServer(e,t){try{if(this.isLocalDev)return console.log(`üîß BackendService: –õ–æ–∫–∞–ª—å–Ω–∞ —Ä–æ–∑—Ä–æ–±–∫–∞ - –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è ${e}`),t;const s=await this.loadSettings(e);if(!s)return await this.saveSettings(e,t),t;const i=new Date(s.lastModified||0).getTime(),o=new Date(t.lastModified||0).getTime();return i>o?(console.log(`üîÑ BackendService: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å–µ—Ä–≤–µ—Ä–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è ${e}`),s):(console.log(`üîÑ BackendService: –û–Ω–æ–≤–ª—é—î–º–æ —Å–µ—Ä–≤–µ—Ä –ª–æ–∫–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ –¥–ª—è ${e}`),await this.saveSettings(e,t),t)}catch(s){return console.error(`‚ùå BackendService: –ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó ${e}:`,s),t}}}const h=new l;export{h as backendService};
