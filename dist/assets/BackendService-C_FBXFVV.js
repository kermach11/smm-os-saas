var i=Object.defineProperty;var a=(s,e,t)=>e in s?i(s,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[e]=t;var o=(s,e,t)=>a(s,typeof e!="symbol"?e+"":e,t);class d{constructor(){o(this,"siteId");o(this,"baseUrl");this.siteId=this.generateSiteId(),this.baseUrl="/.netlify/functions"}generateSiteId(){const e=window.location.hostname;return e==="localhost"||e==="127.0.0.1"?`dev-${Date.now()}`:e.replace(/\./g,"-")}async saveSettings(e,t){try{console.log(`üíæ BackendService: –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è ${e} –¥–ª—è —Å–∞–π—Ç—É ${this.siteId}`);const r=await fetch(`${this.baseUrl}/save-settings`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({siteId:this.siteId,settingsType:e,data:t})});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const n=await r.json();return console.log(`‚úÖ BackendService: ${e} –∑–±–µ—Ä–µ–∂–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ`),n.success}catch(r){return console.error(`‚ùå BackendService: –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è ${e}:`,r),!1}}async loadSettings(e){try{console.log(`üîÑ BackendService: –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ${e} –¥–ª—è —Å–∞–π—Ç—É ${this.siteId}`);const t=await fetch(`${this.baseUrl}/load-settings?siteId=${this.siteId}&settingsType=${e}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const r=await t.json();return r.success&&r.data?(console.log(`‚úÖ BackendService: ${e} –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ —É—Å–ø—ñ—à–Ω–æ`),r.data):(console.log(`‚ÑπÔ∏è BackendService: ${e} –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä—ñ`),null)}catch(t){return console.error(`‚ùå BackendService: –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è ${e}:`,t),null}}async checkConnection(){try{return(await fetch(`${this.baseUrl}/load-settings?siteId=test&settingsType=test`)).status!==404}catch{return console.warn("‚ö†Ô∏è BackendService: Backend –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –ª–æ–∫–∞–ª—å–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è"),!1}}getSiteInfo(){return{siteId:this.siteId,domain:window.location.hostname}}async syncWithServer(e,t){try{const r=await this.loadSettings(e);if(!r)return await this.saveSettings(e,t),t;const n=new Date(r.lastModified||0).getTime(),c=new Date(t.lastModified||0).getTime();return n>c?(console.log(`üîÑ BackendService: –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Å–µ—Ä–≤–µ—Ä–Ω—ñ –¥–∞–Ω—ñ –¥–ª—è ${e}`),r):(console.log(`üîÑ BackendService: –û–Ω–æ–≤–ª—é—î–º–æ —Å–µ—Ä–≤–µ—Ä –ª–æ–∫–∞–ª—å–Ω–∏–º–∏ –¥–∞–Ω–∏–º–∏ –¥–ª—è ${e}`),await this.saveSettings(e,t),t)}catch(r){return console.error(`‚ùå BackendService: –ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó ${e}:`,r),t}}}const h=new d;export{h as backendService};
