<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –≤–∞–∂–∫–∏—Ö –∞—É–¥—ñ–æ —Ñ–∞–π–ª—ñ–≤</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-section h3 {
            margin-top: 0;
            color: #333;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
            max-height: 300px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }
        .status.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .status.warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ –¢–µ—Å—Ç –≤–∞–∂–∫–∏—Ö –∞—É–¥—ñ–æ —Ñ–∞–π–ª—ñ–≤</h1>
        <p>–¶–µ–π —Ç–µ—Å—Ç –ø–µ—Ä–µ–≤—ñ—Ä—è—î —Ä–æ–±–æ—Ç—É –∑ –≤–∞–∂–∫–∏–º–∏ –∞—É–¥—ñ–æ —Ñ–∞–π–ª–∞–º–∏ –≤ ContentManager</p>

        <div class="test-section">
            <h3>üìä –Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –ø—Ä–æ —Å—Ö–æ–≤–∏—â–µ</h3>
            <button onclick="checkStorage()">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Å—Ö–æ–≤–∏—â–µ</button>
            <button onclick="clearStorage()">–û—á–∏—Å—Ç–∏—Ç–∏ —Å—Ö–æ–≤–∏—â–µ</button>
            <div id="storageInfo" class="log"></div>
        </div>

        <div class="test-section">
            <h3>üéµ –¢–µ—Å—Ç —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–∞–∂–∫–æ–≥–æ –∞—É–¥—ñ–æ —Ñ–∞–π–ª—É</h3>
            <button onclick="createHeavyAudioFile()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –≤–∞–∂–∫–∏–π –∞—É–¥—ñ–æ —Ñ–∞–π–ª (5MB)</button>
            <button onclick="createLightAudioFile()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ª–µ–≥–∫–∏–π –∞—É–¥—ñ–æ —Ñ–∞–π–ª (100KB)</button>
            <div id="fileCreationLog" class="log"></div>
        </div>

        <div class="test-section">
            <h3>üíæ –¢–µ—Å—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ IndexedDB</h3>
            <button onclick="testIndexedDBSave()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è</button>
            <button onclick="testIndexedDBLoad()">–¢–µ—Å—Ç—É–≤–∞—Ç–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è</button>
            <div id="indexedDBLog" class="log"></div>
        </div>

        <div class="test-section">
            <h3>üîÑ –¢–µ—Å—Ç –ø–æ–≤–Ω–æ–≥–æ —Ü–∏–∫–ª—É</h3>
            <button onclick="testFullCycle()">–ü–æ–≤–Ω–∏–π —Ç–µ—Å—Ç</button>
            <div id="fullTestLog" class="log"></div>
        </div>

        <div id="status" class="status" style="display: none;"></div>
    </div>

    <script>
        let testFiles = [];
        
        function log(message, containerId = 'storageInfo') {
            const container = document.getElementById(containerId);
            const timestamp = new Date().toLocaleTimeString();
            container.innerHTML += `[${timestamp}] ${message}\n`;
            container.scrollTop = container.scrollHeight;
            console.log(message);
        }

        function showStatus(message, type = 'success') {
            const status = document.getElementById('status');
            status.className = `status ${type}`;
            status.textContent = message;
            status.style.display = 'block';
            setTimeout(() => {
                status.style.display = 'none';
            }, 5000);
        }

        function checkStorage() {
            log('üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ localStorage...', 'storageInfo');
            
            const localStorageData = localStorage.getItem('contentManagerFiles');
            if (localStorageData) {
                const files = JSON.parse(localStorageData);
                log(`üìÇ localStorage: ${files.length} —Ñ–∞–π–ª—ñ–≤`, 'storageInfo');
                files.forEach(file => {
                    log(`  - ${file.name} (${file.type}, ${(file.size / 1024 / 1024).toFixed(2)} MB, URL: ${file.url ? '—î' : '–Ω–µ–º–∞—î'})`, 'storageInfo');
                });
            } else {
                log('üìÇ localStorage –ø–æ—Ä–æ–∂–Ω—ñ–π', 'storageInfo');
            }

            // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ IndexedDB
            log('üîç –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ IndexedDB...', 'storageInfo');
            const request = indexedDB.open('ContentManagerDB', 1);
            
            request.onsuccess = (event) => {
                const db = event.target.result;
                if (db.objectStoreNames.contains('files')) {
                    const transaction = db.transaction(['files'], 'readonly');
                    const store = transaction.objectStore('files');
                    const getAllRequest = store.getAll();
                    
                    getAllRequest.onsuccess = () => {
                        const files = getAllRequest.result;
                        log(`üíæ IndexedDB: ${files.length} —Ñ–∞–π–ª—ñ–≤`, 'storageInfo');
                        files.forEach(file => {
                            log(`  - ${file.name} (${file.type}, ${(file.size / 1024 / 1024).toFixed(2)} MB, URL: ${file.url ? '—î' : '–Ω–µ–º–∞—î'})`, 'storageInfo');
                        });
                        db.close();
                    };
                } else {
                    log('üíæ IndexedDB: –æ–±\'—î–∫—Ç-—Å—Ö–æ–≤–∏—â–µ –Ω–µ —ñ—Å–Ω—É—î', 'storageInfo');
                    db.close();
                }
            };
            
            request.onerror = () => {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è IndexedDB', 'storageInfo');
            };
        }

        function clearStorage() {
            localStorage.removeItem('contentManagerFiles');
            log('üóëÔ∏è localStorage –æ—á–∏—â–µ–Ω–æ', 'storageInfo');
            
            const request = indexedDB.deleteDatabase('ContentManagerDB');
            request.onsuccess = () => {
                log('üóëÔ∏è IndexedDB –æ—á–∏—â–µ–Ω–æ', 'storageInfo');
                showStatus('–°—Ö–æ–≤–∏—â–µ –æ—á–∏—â–µ–Ω–æ', 'success');
            };
            request.onerror = () => {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞ –æ—á–∏—â–µ–Ω–Ω—è IndexedDB', 'storageInfo');
            };
        }

        function createHeavyAudioFile() {
            log('üéµ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –≤–∞–∂–∫–æ–≥–æ –∞—É–¥—ñ–æ —Ñ–∞–π–ª—É (5MB)...', 'fileCreationLog');
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ–µ–π–∫–æ–≤–∏–π –∞—É–¥—ñ–æ —Ñ–∞–π–ª 5MB
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const sampleRate = 44100;
            const duration = 60; // 60 —Å–µ–∫—É–Ω–¥
            const channels = 2;
            const frameCount = sampleRate * duration;
            
            const arrayBuffer = audioContext.createBuffer(channels, frameCount, sampleRate);
            
            // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –±—É—Ñ–µ—Ä –±—ñ–ª–∏–º —à—É–º–æ–º
            for (let channel = 0; channel < channels; channel++) {
                const nowBuffering = arrayBuffer.getChannelData(channel);
                for (let i = 0; i < frameCount; i++) {
                    nowBuffering[i] = Math.random() * 2 - 1;
                }
            }
            
            // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –≤ Base64
            const wavData = audioBufferToWav(arrayBuffer);
            const base64 = arrayBufferToBase64(wavData);
            const dataUrl = `data:audio/wav;base64,${base64}`;
            
            const heavyFile = {
                id: `heavy-audio-${Date.now()}`,
                name: '–í–∞–∂–∫–∏–π –∞—É–¥—ñ–æ —Ñ–∞–π–ª',
                type: 'audio',
                url: dataUrl,
                originalName: 'heavy-audio.wav',
                size: wavData.byteLength,
                uploadDate: new Date().toISOString(),
                optimized: false
            };
            
            testFiles.push(heavyFile);
            log(`‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –≤–∞–∂–∫–∏–π —Ñ–∞–π–ª: ${heavyFile.name} (${(heavyFile.size / 1024 / 1024).toFixed(2)} MB)`, 'fileCreationLog');
            showStatus(`–°—Ç–≤–æ—Ä–µ–Ω–æ –≤–∞–∂–∫–∏–π —Ñ–∞–π–ª: ${(heavyFile.size / 1024 / 1024).toFixed(2)} MB`, 'success');
        }

        function createLightAudioFile() {
            log('üéµ –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –ª–µ–≥–∫–æ–≥–æ –∞—É–¥—ñ–æ —Ñ–∞–π–ª—É (100KB)...', 'fileCreationLog');
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ —Ñ–µ–π–∫–æ–≤–∏–π –∞—É–¥—ñ–æ —Ñ–∞–π–ª 100KB
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const sampleRate = 44100;
            const duration = 1; // 1 —Å–µ–∫—É–Ω–¥–∞
            const channels = 1;
            const frameCount = sampleRate * duration;
            
            const arrayBuffer = audioContext.createBuffer(channels, frameCount, sampleRate);
            
            // –ó–∞–ø–æ–≤–Ω—é—î–º–æ –±—É—Ñ–µ—Ä —Å–∏–Ω—É—Å–æ—ó–¥–æ—é
            const nowBuffering = arrayBuffer.getChannelData(0);
            for (let i = 0; i < frameCount; i++) {
                nowBuffering[i] = Math.sin(2 * Math.PI * 440 * i / sampleRate) * 0.5;
            }
            
            // –ö–æ–Ω–≤–µ—Ä—Ç—É—î–º–æ –≤ Base64
            const wavData = audioBufferToWav(arrayBuffer);
            const base64 = arrayBufferToBase64(wavData);
            const dataUrl = `data:audio/wav;base64,${base64}`;
            
            const lightFile = {
                id: `light-audio-${Date.now()}`,
                name: '–õ–µ–≥–∫–∏–π –∞—É–¥—ñ–æ —Ñ–∞–π–ª',
                type: 'audio',
                url: dataUrl,
                originalName: 'light-audio.wav',
                size: wavData.byteLength,
                uploadDate: new Date().toISOString(),
                optimized: false
            };
            
            testFiles.push(lightFile);
            log(`‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –ª–µ–≥–∫–∏–π —Ñ–∞–π–ª: ${lightFile.name} (${(lightFile.size / 1024).toFixed(2)} KB)`, 'fileCreationLog');
            showStatus(`–°—Ç–≤–æ—Ä–µ–Ω–æ –ª–µ–≥–∫–∏–π —Ñ–∞–π–ª: ${(lightFile.size / 1024).toFixed(2)} KB`, 'success');
        }

        function testIndexedDBSave() {
            if (testFiles.length === 0) {
                log('‚ö†Ô∏è –°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤—ñ —Ñ–∞–π–ª–∏', 'indexedDBLog');
                showStatus('–°–ø–æ—á–∞—Ç–∫—É —Å—Ç–≤–æ—Ä—ñ—Ç—å —Ç–µ—Å—Ç–æ–≤—ñ —Ñ–∞–π–ª–∏', 'warning');
                return;
            }
            
            log('üíæ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ IndexedDB...', 'indexedDBLog');
            
            const request = indexedDB.open('ContentManagerDB', 1);
            
            request.onupgradeneeded = (event) => {
                const db = event.target.result;
                if (!db.objectStoreNames.contains('files')) {
                    db.createObjectStore('files', { keyPath: 'id' });
                    log('‚úÖ –°—Ç–≤–æ—Ä–µ–Ω–æ –æ–±\'—î–∫—Ç-—Å—Ö–æ–≤–∏—â–µ', 'indexedDBLog');
                }
            };
            
            request.onsuccess = (event) => {
                const db = event.target.result;
                const transaction = db.transaction(['files'], 'readwrite');
                const store = transaction.objectStore('files');
                
                // –û—á–∏—â–∞—î–º–æ —Å—Ç–∞—Ä—ñ –¥–∞–Ω—ñ
                store.clear();
                
                let savedCount = 0;
                testFiles.forEach((file, index) => {
                    const addRequest = store.add(file);
                    
                    addRequest.onsuccess = () => {
                        savedCount++;
                        log(`‚úÖ –ó–±–µ—Ä–µ–∂–µ–Ω–æ —Ñ–∞–π–ª ${savedCount}/${testFiles.length}: ${file.name}`, 'indexedDBLog');
                        
                        if (savedCount === testFiles.length) {
                            log('üéâ –í—Å—ñ —Ñ–∞–π–ª–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ IndexedDB', 'indexedDBLog');
                            showStatus('–§–∞–π–ª–∏ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ IndexedDB', 'success');
                            db.close();
                        }
                    };
                    
                    addRequest.onerror = () => {
                        log(`‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É: ${file.name}`, 'indexedDBLog');
                        showStatus(`–ü–æ–º–∏–ª–∫–∞ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è: ${file.name}`, 'error');
                        db.close();
                    };
                });
            };
            
            request.onerror = () => {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è IndexedDB', 'indexedDBLog');
                showStatus('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è IndexedDB', 'error');
            };
        }

        function testIndexedDBLoad() {
            log('üìÇ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∑ IndexedDB...', 'indexedDBLog');
            
            const request = indexedDB.open('ContentManagerDB', 1);
            
            request.onsuccess = (event) => {
                const db = event.target.result;
                
                if (!db.objectStoreNames.contains('files')) {
                    log('‚ö†Ô∏è –û–±\'—î–∫—Ç-—Å—Ö–æ–≤–∏—â–µ –Ω–µ —ñ—Å–Ω—É—î', 'indexedDBLog');
                    showStatus('–û–±\'—î–∫—Ç-—Å—Ö–æ–≤–∏—â–µ –Ω–µ —ñ—Å–Ω—É—î', 'warning');
                    db.close();
                    return;
                }
                
                const transaction = db.transaction(['files'], 'readonly');
                const store = transaction.objectStore('files');
                const getAllRequest = store.getAll();
                
                getAllRequest.onsuccess = () => {
                    const files = getAllRequest.result;
                    log(`üìÇ –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${files.length} —Ñ–∞–π–ª—ñ–≤ –∑ IndexedDB`, 'indexedDBLog');
                    
                    files.forEach(file => {
                        const hasUrl = file.url && file.url.length > 0;
                        log(`  - ${file.name}: ${hasUrl ? '‚úÖ URL —î' : '‚ùå URL –Ω–µ–º–∞—î'}`, 'indexedDBLog');
                    });
                    
                    showStatus(`–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ ${files.length} —Ñ–∞–π–ª—ñ–≤`, 'success');
                    db.close();
                };
                
                getAllRequest.onerror = () => {
                    log('‚ùå –ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤', 'indexedDBLog');
                    showStatus('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤', 'error');
                    db.close();
                };
            };
            
            request.onerror = () => {
                log('‚ùå –ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è IndexedDB', 'indexedDBLog');
                showStatus('–ü–æ–º–∏–ª–∫–∞ –≤—ñ–¥–∫—Ä–∏—Ç—Ç—è IndexedDB', 'error');
            };
        }

        function testFullCycle() {
            log('üîÑ –ü–æ—á–∞—Ç–æ–∫ –ø–æ–≤–Ω–æ–≥–æ —Ç–µ—Å—Ç—É...', 'fullTestLog');
            
            // –û—á–∏—â–∞—î–º–æ —Å—Ö–æ–≤–∏—â–µ
            localStorage.removeItem('contentManagerFiles');
            
            const deleteRequest = indexedDB.deleteDatabase('ContentManagerDB');
            deleteRequest.onsuccess = () => {
                log('üóëÔ∏è –°—Ö–æ–≤–∏—â–µ –æ—á–∏—â–µ–Ω–æ', 'fullTestLog');
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ—Å—Ç–æ–≤—ñ —Ñ–∞–π–ª–∏
                createHeavyAudioFile();
                createLightAudioFile();
                
                setTimeout(() => {
                    log('üíæ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è...', 'fullTestLog');
                    
                    // –°–∏–º—É–ª—é—î–º–æ –ª–æ–≥—ñ–∫—É ContentManager
                    const dataToSave = JSON.stringify(testFiles);
                    const sizeInMB = (new Blob([dataToSave]).size / 1024 / 1024).toFixed(2);
                    
                    log(`üìä –†–æ–∑–º—ñ—Ä –¥–∞–Ω–∏—Ö: ${sizeInMB} MB`, 'fullTestLog');
                    
                    if (new Blob([dataToSave]).size > 4.5 * 1024 * 1024) {
                        log('‚ö†Ô∏è –î–∞–Ω—ñ –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫—ñ –¥–ª—è localStorage. –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ IndexedDB...', 'fullTestLog');
                        
                        // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –≤ IndexedDB
                        testIndexedDBSave();
                        
                        setTimeout(() => {
                            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –º–µ—Ç–∞–¥–∞–Ω—ñ –≤ localStorage
                            const metadataOnly = testFiles.map(file => ({
                                ...file,
                                url: file.type === 'audio' ? '' : file.url
                            }));
                            localStorage.setItem('contentManagerFiles', JSON.stringify(metadataOnly));
                            log('‚úÖ –ú–µ—Ç–∞–¥–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ localStorage', 'fullTestLog');
                            
                            setTimeout(() => {
                                log('üìÇ –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...', 'fullTestLog');
                                testIndexedDBLoad();
                                showStatus('–ü–æ–≤–Ω–∏–π —Ç–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–æ', 'success');
                            }, 1000);
                        }, 2000);
                    } else {
                        localStorage.setItem('contentManagerFiles', dataToSave);
                        log('‚úÖ –î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ localStorage', 'fullTestLog');
                        showStatus('–î–∞–Ω—ñ –∑–±–µ—Ä–µ–∂–µ–Ω–æ –≤ localStorage', 'success');
                    }
                }, 1000);
            };
        }

        // –î–æ–ø–æ–º—ñ–∂–Ω—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –¥–ª—è —Ä–æ–±–æ—Ç–∏ –∑ –∞—É–¥—ñ–æ
        function audioBufferToWav(buffer) {
            const length = buffer.length;
            const numberOfChannels = buffer.numberOfChannels;
            const sampleRate = buffer.sampleRate;
            const arrayBuffer = new ArrayBuffer(44 + length * numberOfChannels * 2);
            const view = new DataView(arrayBuffer);
            
            // WAV header
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };
            
            writeString(0, 'RIFF');
            view.setUint32(4, 36 + length * numberOfChannels * 2, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numberOfChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, sampleRate * numberOfChannels * 2, true);
            view.setUint16(32, numberOfChannels * 2, true);
            view.setUint16(34, 16, true);
            writeString(36, 'data');
            view.setUint32(40, length * numberOfChannels * 2, true);
            
            // PCM data
            let offset = 44;
            for (let i = 0; i < length; i++) {
                for (let channel = 0; channel < numberOfChannels; channel++) {
                    const sample = Math.max(-1, Math.min(1, buffer.getChannelData(channel)[i]));
                    view.setInt16(offset, sample < 0 ? sample * 0x8000 : sample * 0x7FFF, true);
                    offset += 2;
                }
            }
            
            return arrayBuffer;
        }

        function arrayBufferToBase64(buffer) {
            let binary = '';
            const bytes = new Uint8Array(buffer);
            const len = bytes.byteLength;
            for (let i = 0; i < len; i++) {
                binary += String.fromCharCode(bytes[i]);
            }
            return window.btoa(binary);
        }

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        document.addEventListener('DOMContentLoaded', () => {
            log('üöÄ –¢–µ—Å—Ç –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏', 'storageInfo');
            checkStorage();
        });
    </script>
</body>
</html> 